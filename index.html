<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全球市场流动性监控仪表盘</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .dashboard-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
        }
        
        .dashboard-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            animation: pulse 2s infinite;
        }
        
        .status-loose { background-color: #10b981; }
        .status-neutral { background-color: #f59e0b; }
        .status-tight { background-color: #ef4444; }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .metric-value {
            font-size: 2.5rem;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            transition: all 0.3s ease;
        }
        
        .metric-value.updating {
            transform: scale(1.05);
        }
        
        .chart-container {
            position: relative;
            height: 200px;
            width: 100%;
        }
        
        .gauge {
            width: 150px;
            height: 150px;
            margin: 0 auto;
        }
        
        .progress-ring {
            transition: stroke-dashoffset 0.35s;
            transform: rotate(-90deg);
            transform-origin: 50% 50%;
        }
        
        .update-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: #10b981;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .update-indicator.active {
            opacity: 1;
            animation: blink 0.5s ease-in-out;
        }
        
        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .countdown {
            font-size: 0.75rem;
            color: #6b7280;
        }
    </style>
</head>
<body class="p-4">
    <div class="max-w-7xl mx-auto">
        <!-- Header -->
        <div class="dashboard-card p-6 mb-6">
            <div class="flex items-center justify-between">
                <div>
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">
                        <i class="fas fa-tachometer-alt mr-3 text-indigo-600"></i>
                        全球市场流动性监控仪表盘
                    </h1>
                    <p class="text-gray-600">
                        实时监控全球流动性状况 · 数据更新时间: <span id="lastUpdate" class="font-semibold"></span>
                        <span class="ml-4 countdown">下次更新倒计时: <span id="countdown" class="font-mono">60s</span></span>
                    </p>
                </div>
                <div class="text-right">
                    <div class="text-sm text-gray-500 mb-1">流动性状态</div>
                    <div id="overallStatus" class="text-lg font-semibold flex items-center justify-end">
                        <span class="status-indicator status-neutral"></span>
                        中性偏宽松
                    </div>
                    <div class="update-indicator" id="updateIndicator"></div>
                </div>
            </div>
        </div>

        <!-- Legend -->
        <div class="dashboard-card p-4 mb-6">
            <h3 class="text-lg font-semibold mb-3 text-gray-800">
                <i class="fas fa-info-circle mr-2 text-blue-500"></i>指标解读
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                <div class="flex items-center">
                    <div class="status-indicator status-loose"></div>
                    <span class="font-medium text-green-700">宽松</span>
                    <span class="text-gray-600 ml-2">流动性充裕，市场交易活跃</span>
                </div>
                <div class="flex items-center">
                    <div class="status-indicator status-neutral"></div>
                    <span class="font-medium text-yellow-700">中性</span>
                    <span class="text-gray-600 ml-2">流动性适中，市场运行正常</span>
                </div>
                <div class="flex items-center">
                    <div class="status-indicator status-tight"></div>
                    <span class="font-medium text-red-700">紧张</span>
                    <span class="text-gray-600 ml-2">流动性紧缩，市场承压运行</span>
                </div>
            </div>
        </div>

        <!-- Main Dashboard Grid -->
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-6">
            <!-- RRP Balance -->
            <div class="dashboard-card p-6" style="position: relative;">
                <div class="update-indicator" id="rrpUpdate"></div>
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">美联储RRP余额</h3>
                    <span class="status-indicator" id="rrpStatus"></span>
                </div>
                <div class="metric-value mb-2" id="rrpValue">$1.2T</div>
                <div class="text-sm text-gray-600 mb-3">资金"水位"指标</div>
                <div class="chart-container">
                    <canvas id="rrpChart"></canvas>
                </div>
                <div class="text-xs text-gray-500 mt-2" id="rrpTrend">
                    <i class="fas fa-arrow-down text-orange-500 mr-1"></i>
                    相比上月下降15%，流动性边际收紧
                </div>
            </div>

            <!-- SOFR Rate -->
            <div class="dashboard-card p-6" style="position: relative;">
                <div class="update-indicator" id="sofrUpdate"></div>
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">SOFR利率</h3>
                    <span class="status-indicator" id="sofrStatus"></span>
                </div>
                <div class="metric-value mb-2" id="sofrValue">4.33%</div>
                <div class="text-sm text-gray-600 mb-3">隔夜资金价格</div>
                <div class="gauge">
                    <svg class="w-full h-full" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="40" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                        <circle cx="50" cy="50" r="40" stroke="#f59e0b" stroke-width="8" fill="none" 
                                stroke-dasharray="251" stroke-dashoffset="125" class="progress-ring" id="sofrGauge"/>
                        <text x="50" y="55" text-anchor="middle" class="text-sm font-bold fill-gray-700" id="sofrGaugeText">4.33%</text>
                    </svg>
                </div>
                <div class="text-xs text-gray-500 mt-2" id="sofrTrend">
                    <i class="fas fa-minus text-yellow-500 mr-1"></i>
                    基本稳定，符合政策预期
                </div>
            </div>

            <!-- VIX Index -->
            <div class="dashboard-card p-6" style="position: relative;">
                <div class="update-indicator" id="vixUpdate"></div>
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">VIX恐慌指数</h3>
                    <span class="status-indicator" id="vixStatus"></span>
                </div>
                <div class="metric-value mb-2" id="vixValue">15.79</div>
                <div class="text-sm text-gray-600 mb-3">市场波动率/恐慌度</div>
                <div class="chart-container">
                    <canvas id="vixChart"></canvas>
                </div>
                <div class="text-xs text-gray-500 mt-2" id="vixTrend">
                    <i class="fas fa-arrow-down text-green-500 mr-1"></i>
                    低于20，市场情绪稳定
                </div>
            </div>

            <!-- MOVE Index -->
            <div class="dashboard-card p-6" style="position: relative;">
                <div class="update-indicator" id="moveUpdate"></div>
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">MOVE指数</h3>
                    <span class="status-indicator" id="moveStatus"></span>
                </div>
                <div class="metric-value mb-2" id="moveValue">80.75</div>
                <div class="text-sm text-gray-600 mb-3">美债波动率</div>
                <div class="gauge">
                    <svg class="w-full h-full" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="40" stroke="#e5e7eb" stroke-width="8" fill="none"/>
                        <circle cx="50" cy="50" r="40" stroke="#f59e0b" stroke-width="8" fill="none" 
                                stroke-dasharray="251" stroke-dashoffset="150" class="progress-ring" id="moveGauge"/>
                        <text x="50" y="55" text-anchor="middle" class="text-sm font-bold fill-gray-700" id="moveGaugeText">80.75</text>
                    </svg>
                </div>
                <div class="text-xs text-gray-500 mt-2" id="moveTrend">
                    <i class="fas fa-minus text-yellow-500 mr-1"></i>
                    处于历史中位数附近
                </div>
            </div>
        </div>

        <!-- Secondary Indicators -->
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-6">
            <!-- Credit Spreads -->
            <div class="dashboard-card p-6" style="position: relative;">
                <div class="update-indicator" id="spreadUpdate"></div>
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">信用利差</h3>
                    <span class="status-indicator status-loose"></span>
                </div>
                <div class="grid grid-cols-2 gap-4 mb-4">
                    <div>
                        <div class="text-sm text-gray-600">投资级</div>
                        <div class="text-xl font-bold text-green-600" id="igSpread">95bp</div>
                    </div>
                    <div>
                        <div class="text-sm text-gray-600">高收益</div>
                        <div class="text-xl font-bold text-orange-600" id="hySpread">290bp</div>
                    </div>
                </div>
                <div class="chart-container">
                    <canvas id="spreadChart"></canvas>
                </div>
                <div class="text-xs text-gray-500 mt-2" id="spreadTrend">
                    <i class="fas fa-arrow-down text-green-500 mr-1"></i>
                    利差收窄，信用环境宽松
                </div>
            </div>

            <!-- Stablecoin Market Cap -->
            <div class="dashboard-card p-6" style="position: relative;">
                <div class="update-indicator" id="stablecoinUpdate"></div>
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">稳定币市值</h3>
                    <span class="status-indicator status-neutral"></span>
                </div>
                <div class="metric-value mb-2" id="stablecoinValue">$278B</div>
                <div class="text-sm text-gray-600 mb-3">链上流动性基础</div>
                <div class="space-y-2 mb-4">
                    <div class="flex justify-between text-sm">
                        <span>USDT</span>
                        <span class="font-semibold" id="usdtValue">$159B (57%)</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>USDC</span>
                        <span class="font-semibold" id="usdcValue">$63B (23%)</span>
                    </div>
                    <div class="flex justify-between text-sm">
                        <span>DAI</span>
                        <span class="font-semibold" id="daiValue">$5.4B (2%)</span>
                    </div>
                </div>
                <div class="text-xs text-gray-500" id="stablecoinTrend">
                    <i class="fas fa-arrow-up text-green-500 mr-1"></i>
                    总量增长6%，加密流动性充足
                </div>
            </div>

            <!-- S&P 500 Liquidity -->
            <div class="dashboard-card p-6" style="position: relative;">
                <div class="update-indicator" id="spUpdate"></div>
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-semibold text-gray-800">美股流动性</h3>
                    <span class="status-indicator status-loose"></span>
                </div>
                <div class="grid grid-cols-1 gap-3 mb-4">
                    <div>
                        <div class="flex justify-between text-sm">
                            <span>日均成交量</span>
                            <span class="font-semibold" id="spVolume">$516B</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                            <div class="bg-green-500 h-2 rounded-full" style="width: 85%" id="volumeBar"></div>
                        </div>
                    </div>
                    <div>
                        <div class="flex justify-between text-sm">
                            <span>买卖价差</span>
                            <span class="font-semibold" id="spSpread">0.01%</span>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2 mt-1">
                            <div class="bg-green-500 h-2 rounded-full" style="width: 95%" id="spreadBar"></div>
                        </div>
                    </div>
                </div>
                <div class="text-xs text-gray-500">
                    <i class="fas fa-check text-green-500 mr-1"></i>
                    市场深度充足，交易顺畅
                </div>
            </div>
        </div>

        <!-- Comprehensive Analysis -->
        <div class="dashboard-card p-6 mb-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">
                <i class="fas fa-chart-line mr-3 text-indigo-600"></i>
                综合流动性分析
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-6">
                <div class="text-center">
                    <div class="text-3xl font-bold text-green-600 mb-2" id="moneyMarket">75%</div>
                    <div class="text-sm text-gray-600">货币市场</div>
                    <div class="text-xs text-green-600">宽松</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-yellow-600 mb-2" id="bondMarket">60%</div>
                    <div class="text-sm text-gray-600">债券市场</div>
                    <div class="text-xs text-yellow-600">中性</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-green-600 mb-2" id="stockMarket">85%</div>
                    <div class="text-sm text-gray-600">股票市场</div>
                    <div class="text-xs text-green-600">宽松</div>
                </div>
                <div class="text-center">
                    <div class="text-3xl font-bold text-yellow-600 mb-2" id="cryptoMarket">65%</div>
                    <div class="text-sm text-gray-600">加密市场</div>
                    <div class="text-xs text-yellow-600">中性</div>
                </div>
            </div>
            
            <div class="bg-gray-50 rounded-lg p-4">
                <h4 class="font-semibold text-gray-800 mb-3">市场解读要点</h4>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-700">
                    <div>
                        <div class="flex items-start mb-2">
                            <i class="fas fa-water text-blue-500 mr-2 mt-1"></i>
                            <span><strong>资金水位（RRP）：</strong>余额下降表明资金从央行流出回到市场，流动性边际收紧但仍充足</span>
                        </div>
                        <div class="flex items-start mb-2">
                            <i class="fas fa-percentage text-orange-500 mr-2 mt-1"></i>
                            <span><strong>融资成本（SOFR）：</strong>4.33%处于合理区间，与美联储政策目标一致</span>
                        </div>
                    </div>
                    <div>
                        <div class="flex items-start mb-2">
                            <i class="fas fa-chart-bar text-green-500 mr-2 mt-1"></i>
                            <span><strong>风险情绪（VIX）：</strong>15.79低位运行，投资者情绪稳定，市场风险偏好较高</span>
                        </div>
                        <div class="flex items-start mb-2">
                            <i class="fas fa-coins text-purple-500 mr-2 mt-1"></i>
                            <span><strong>链上资金：</strong>稳定币总量增长，为加密市场提供充足流动性支撑</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Market Outlook -->
        <div class="dashboard-card p-6">
            <h3 class="text-xl font-bold text-gray-800 mb-4">
                <i class="fas fa-crystal-ball mr-3 text-purple-600"></i>
                流动性展望
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                    <h4 class="font-semibold text-green-800 mb-2">
                        <i class="fas fa-thumbs-up mr-2"></i>正面因素
                    </h4>
                    <ul class="text-sm text-green-700 space-y-1">
                        <li>• VIX维持低位，市场情绪稳定</li>
                        <li>• 信用利差收窄，信用环境宽松</li>
                        <li>• 美股交易量充足，市场深度良好</li>
                        <li>• 稳定币市值增长，链上流动性充裕</li>
                    </ul>
                </div>
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4">
                    <h4 class="font-semibold text-yellow-800 mb-2">
                        <i class="fas fa-exclamation-triangle mr-2"></i>关注因素
                    </h4>
                    <ul class="text-sm text-yellow-700 space-y-1">
                        <li>• RRP余额下降趋势需持续关注</li>
                        <li>• MOVE指数处于中位数，债券波动性适中</li>
                        <li>• 美联储政策调整对短期利率影响</li>
                        <li>• 地缘政治风险对避险需求的影响</li>
                    </ul>
                </div>
                <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                    <h4 class="font-semibold text-blue-800 mb-2">
                        <i class="fas fa-lightbulb mr-2"></i>投资建议
                    </h4>
                    <ul class="text-sm text-blue-700 space-y-1">
                        <li>• 当前流动性环境总体有利于风险资产</li>
                        <li>• 建议维持适度风险偏好配置</li>
                        <li>• 关注RRP数据变化趋势</li>
                        <li>• 保持对波动率指标的敏感度</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables for charts and data
        let rrpChart, vixChart, spreadChart;
        let countdownTimer = 60;
        let currentData = {
            rrp: { value: 1.2, trend: -0.15, status: 'neutral' },
            sofr: { value: 4.33, trend: 0, status: 'neutral' },
            vix: { value: 15.79, trend: -0.5, status: 'loose' },
            move: { value: 80.75, trend: 0, status: 'neutral' },
            igSpread: { value: 95, trend: -2 },
            hySpread: { value: 290, trend: -5 },
            stablecoin: { total: 278, usdt: 159, usdc: 63, dai: 5.4 },
            spVolume: { value: 516, spread: 0.01 }
        };

        // API配置
        const API_CONFIG = {
            // 使用免费的代理服务避免CORS问题
            CORS_PROXY: 'https://api.allorigins.win/get?url=',
            
            // 数据源API
            FRED_BASE: 'https://api.stlouisfed.org/fred/series/observations',
            FRED_API_KEY: '260f54bb6baa12ea0f89ce6788cd9573', // 需要在 https://fred.stlouisfed.org/docs/api/api_key.html 申请
            
            YAHOO_FINANCE: 'https://query1.finance.yahoo.com/v8/finance/chart/',
            COINGECKO: 'https://api.coingecko.com/api/v3/',
            
            // FRED数据系列ID
            SERIES_IDS: {
                RRP: 'RRPONTSYD',           // 隔夜逆回购余额
                SOFR: 'SOFR',               // SOFR利率
                IG_SPREAD: 'BAMLC0A1CAAAEY', // 投资级信用利差
                HY_SPREAD: 'BAMLH0A0HYM2EY'  // 高收益信用利差
            }
        };

        // 获取FRED数据的通用函数
        async function fetchFredData(seriesId, fallbackValue) {
            try {
                const url = `${API_CONFIG.FRED_BASE}?series_id=${seriesId}&api_key=${API_CONFIG.FRED_API_KEY}&file_type=json&limit=1&sort_order=desc`;
                const proxyUrl = `${API_CONFIG.CORS_PROXY}${encodeURIComponent(url)}`;
                
                const response = await fetch(proxyUrl);
                const data = await response.json();
                const fredData = JSON.parse(data.contents);
                
                if (fredData.observations && fredData.observations.length > 0) {
                    return parseFloat(fredData.observations[0].value);
                }
                return fallbackValue;
            } catch (error) {
                console.warn(`获取FRED数据失败 (${seriesId}):`, error);
                return fallbackValue;
            }
        }

        // 获取Yahoo Finance数据
        async function fetchYahooData(symbol, fallbackValue) {
            try {
                const url = `${API_CONFIG.YAHOO_FINANCE}${symbol}`;
                const proxyUrl = `${API_CONFIG.CORS_PROXY}${encodeURIComponent(url)}`;
                
                const response = await fetch(proxyUrl);
                const data = await response.json();
                const yahooData = JSON.parse(data.contents);
                
                if (yahooData.chart && yahooData.chart.result && yahooData.chart.result.length > 0) {
                    const result = yahooData.chart.result[0];
                    const meta = result.meta;
                    return meta.regularMarketPrice || meta.previousClose || fallbackValue;
                }
                return fallbackValue;
            } catch (error) {
                console.warn(`获取Yahoo Finance数据失败 (${symbol}):`, error);
                return fallbackValue;
            }
        }

        // 获取CoinGecko数据
        async function fetchCoinGeckoData() {
            try {
                const response = await fetch(`${API_CONFIG.COINGECKO}global`);
                const data = await response.json();
                
                if (data.data) {
                    return {
                        totalMarketCap: data.data.total_market_cap.usd / 1000000000, // 转换为十亿
                        totalVolume: data.data.total_volume.usd / 1000000000
                    };
                }
                return null;
            } catch (error) {
                console.warn('获取CoinGecko数据失败:', error);
                return null;
            }
        }

        // 获取具体稳定币数据
        async function fetchStablecoinData() {
            try {
                const coins = ['tether', 'usd-coin', 'dai'];
                const response = await fetch(`${API_CONFIG.COINGECKO}coins/markets?vs_currency=usd&ids=${coins.join(',')}&order=market_cap_desc`);
                const data = await response.json();
                
                let total = 0;
                let usdt = 0, usdc = 0, dai = 0;
                
                data.forEach(coin => {
                    const marketCap = coin.market_cap / 1000000000; // 转换为十亿
                    total += marketCap;
                    
                    switch(coin.id) {
                        case 'tether': usdt = marketCap; break;
                        case 'usd-coin': usdc = marketCap; break;
                        case 'dai': dai = marketCap; break;
                    }
                });
                
                return { total, usdt, usdc, dai };
            } catch (error) {
                console.warn('获取稳定币数据失败:', error);
                return null;
            }
        }

        // 模拟数据生成函数（作为备选）
        function generateFallbackData() {
            console.log('使用备选数据生成');
            
            // 基于当前值进行小幅波动
            currentData.rrp.value = Math.max(0.8, Math.min(3.0, currentData.rrp.value + (Math.random() - 0.5) * 0.05));
            currentData.sofr.value = Math.max(3.0, Math.min(6.0, currentData.sofr.value + (Math.random() - 0.5) * 0.05));
            currentData.vix.value = Math.max(10, Math.min(40, currentData.vix.value + (Math.random() - 0.5) * 1));
            currentData.move.value = Math.max(60, Math.min(120, currentData.move.value + (Math.random() - 0.5) * 2));
            currentData.igSpread.value = Math.max(70, Math.min(150, currentData.igSpread.value + (Math.random() - 0.5) * 2));
            currentData.hySpread.value = Math.max(200, Math.min(500, currentData.hySpread.value + (Math.random() - 0.5) * 5));
            currentData.stablecoin.total = Math.max(200, currentData.stablecoin.total + (Math.random() - 0.5) * 2);
            currentData.stablecoin.usdt = currentData.stablecoin.total * 0.57;
            currentData.stablecoin.usdc = currentData.stablecoin.total * 0.23;
            currentData.spVolume.value = Math.max(400, Math.min(800, currentData.spVolume.value + (Math.random() - 0.5) * 10));
            currentData.spVolume.spread = Math.max(0.005, Math.min(0.02, currentData.spVolume.spread + (Math.random() - 0.5) * 0.001));
        }

        // 更新DOM元素
        function updateDashboard() {
            // 显示更新指示器
            document.getElementById('updateIndicator').classList.add('active');
            document.getElementById('rrpUpdate').classList.add('active');
            document.getElementById('sofrUpdate').classList.add('active');
            document.getElementById('vixUpdate').classList.add('active');
            document.getElementById('moveUpdate').classList.add('active');
            
            // 生成新数据
            generateRealisticData();
            
            // 更新RRP
            const rrpValue = document.getElementById('rrpValue');
            rrpValue.classList.add('updating');
            rrpValue.textContent = `$${currentData.rrp.value.toFixed(1)}T`;
            
            // 更新SOFR
            const sofrValue = document.getElementById('sofrValue');
            const sofrGaugeText = document.getElementById('sofrGaugeText');
            sofrValue.classList.add('updating');
            sofrValue.textContent = `${currentData.sofr.value.toFixed(2)}%`;
            sofrGaugeText.textContent = `${currentData.sofr.value.toFixed(2)}%`;
            
            // 更新VIX
            const vixValue = document.getElementById('vixValue');
            vixValue.classList.add('updating');
            vixValue.textContent = currentData.vix.value.toFixed(2);
            
            // 更新MOVE
            const moveValue = document.getElementById('moveValue');
            const moveGaugeText = document.getElementById('moveGaugeText');
            moveValue.classList.add('updating');
            moveValue.textContent = currentData.move.value.toFixed(2);
            moveGaugeText.textContent = currentData.move.value.toFixed(2);
            
            // 更新信用利差
            document.getElementById('igSpread').textContent = `${Math.round(currentData.igSpread.value)}bp`;
            document.getElementById('hySpread').textContent = `${Math.round(currentData.hySpread.value)}bp`;
            
            // 更新稳定币
            const stablecoinValue = document.getElementById('stablecoinValue');
            stablecoinValue.classList.add('updating');
            stablecoinValue.textContent = `${Math.round(currentData.stablecoin.total)}B`;
            document.getElementById('usdtValue').textContent = `${Math.round(currentData.stablecoin.usdt)}B (57%)`;
            document.getElementById('usdcValue').textContent = `${Math.round(currentData.stablecoin.usdc)}B (23%)`;
            
            // 更新美股流动性
            document.getElementById('spVolume').textContent = `${Math.round(currentData.spVolume.value)}B`;
            document.getElementById('spSpread').textContent = `${currentData.spVolume.spread.toFixed(3)}%`;
            
            // 更新状态指示器
            updateStatusIndicators();
            
            // 更新图表
            updateCharts();
            
            // 更新时间戳
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('zh-CN');
            
            // 移除更新动画
            setTimeout(() => {
                document.querySelectorAll('.metric-value').forEach(el => el.classList.remove('updating'));
                document.querySelectorAll('.update-indicator').forEach(el => el.classList.remove('active'));
            }, 500);
        }

        // 更新状态指示器
        function updateStatusIndicators() {
            // RRP状态
            const rrpStatus = document.getElementById('rrpStatus');
            rrpStatus.className = 'status-indicator';
            if (currentData.rrp.value > 1.5) {
                rrpStatus.classList.add('status-loose');
            } else if (currentData.rrp.value < 1.0) {
                rrpStatus.classList.add('status-tight');
            } else {
                rrpStatus.classList.add('status-neutral');
            }
            
            // SOFR状态
            const sofrStatus = document.getElementById('sofrStatus');
            sofrStatus.className = 'status-indicator';
            if (currentData.sofr.value < 4.0) {
                sofrStatus.classList.add('status-loose');
            } else if (currentData.sofr.value > 5.0) {
                sofrStatus.classList.add('status-tight');
            } else {
                sofrStatus.classList.add('status-neutral');
            }
            
            // VIX状态
            const vixStatus = document.getElementById('vixStatus');
            vixStatus.className = 'status-indicator';
            if (currentData.vix.value < 20) {
                vixStatus.classList.add('status-loose');
            } else if (currentData.vix.value > 30) {
                vixStatus.classList.add('status-tight');
            } else {
                vixStatus.classList.add('status-neutral');
            }
            
            // MOVE状态
            const moveStatus = document.getElementById('moveStatus');
            moveStatus.className = 'status-indicator';
            if (currentData.move.value < 75) {
                moveStatus.classList.add('status-loose');
            } else if (currentData.move.value > 100) {
                moveStatus.classList.add('status-tight');
            } else {
                moveStatus.classList.add('status-neutral');
            }
        }

        // 更新图表
        function updateCharts() {
            // 更新RRP图表
            if (rrpChart) {
                const newRrpData = [...rrpChart.data.datasets[0].data.slice(1), currentData.rrp.value];
                rrpChart.data.datasets[0].data = newRrpData;
                rrpChart.update('none');
            }
            
            // 更新VIX图表
            if (vixChart) {
                const newVixData = [...vixChart.data.datasets[0].data.slice(1), currentData.vix.value];
                vixChart.data.datasets[0].data = newVixData;
                vixChart.update('none');
            }
            
            // 更新信用利差图表
            if (spreadChart) {
                spreadChart.data.datasets[0].data = [currentData.igSpread.value, currentData.hySpread.value];
                spreadChart.update('none');
            }
            
            // 更新仪表盘
            updateGauges();
        }

        // 更新仪表盘
        function updateGauges() {
            // SOFR仪表盘 (0-6%范围)
            const sofrPercentage = (currentData.sofr.value / 6) * 100;
            const sofrOffset = 251 - (251 * sofrPercentage / 100);
            document.getElementById('sofrGauge').style.strokeDashoffset = sofrOffset;
            
            // MOVE仪表盘 (60-120范围)
            const movePercentage = ((currentData.move.value - 60) / 60) * 100;
            const moveOffset = 251 - (251 * movePercentage / 100);
            document.getElementById('moveGauge').style.strokeDashoffset = moveOffset;
        }

        // 倒计时功能
        function updateCountdown() {
            countdownTimer--;
            document.getElementById('countdown').textContent = `${countdownTimer}s`;
            
            if (countdownTimer <= 0) {
                updateDashboard();
                countdownTimer = 60; // 重置为60秒
            }
        }

        // 初始化图表
        function initializeCharts() {
            // RRP Chart
            const rrpCtx = document.getElementById('rrpChart').getContext('2d');
            rrpChart = new Chart(rrpCtx, {
                type: 'line',
                data: {
                    labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月'],
                    datasets: [{
                        label: 'RRP余额(万亿美元)',
                        data: [2.2, 2.1, 1.9, 1.7, 1.5, 1.4, 1.3, currentData.rrp.value],
                        borderColor: '#f59e0b',
                        backgroundColor: 'rgba(245, 158, 11, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    },
                    animation: {
                        duration: 300
                    }
                }
            });

            // VIX Chart
            const vixCtx = document.getElementById('vixChart').getContext('2d');
            vixChart = new Chart(vixCtx, {
                type: 'line',
                data: {
                    labels: ['1月', '2月', '3月', '4月', '5月', '6月', '7月', '8月'],
                    datasets: [{
                        label: 'VIX指数',
                        data: [18.2, 16.5, 20.3, 14.8, 13.2, 15.1, 16.8, currentData.vix.value],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    },
                    animation: {
                        duration: 300
                    }
                }
            });

            // Credit Spread Chart
            const spreadCtx = document.getElementById('spreadChart').getContext('2d');
            spreadChart = new Chart(spreadCtx, {
                type: 'bar',
                data: {
                    labels: ['投资级', '高收益'],
                    datasets: [{
                        data: [currentData.igSpread.value, currentData.hySpread.value],
                        backgroundColor: ['#10b981', '#f59e0b'],
                        borderRadius: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: { legend: { display: false } },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    },
                    animation: {
                        duration: 300
                    }
                }
            });
        }

        // 模拟API调用函数（在实际应用中，这里会是真正的API调用）
        async function fetchRealTimeData() {
            // 这里可以替换为真实的API调用
            // 例如：
            /*
            try {
                const response = await fetch('/api/liquidity-data');
                const data = await response.json();
                currentData = data;
            } catch (error) {
                console.error('获取数据失败:', error);
                // 如果API失败，继续使用模拟数据
                generateRealisticData();
            }
            */
            
            // 当前使用模拟数据
            generateRealisticData();
        }

        // 主要的数据更新函数
        async function performDataUpdate() {
            try {
                await fetchRealTimeData();
                updateDashboard();
            } catch (error) {
                console.error('数据更新失败:', error);
            }
        }

        // 初始化应用
        function initializeApp() {
            // 设置初始时间
            document.getElementById('lastUpdate').textContent = new Date().toLocaleString('zh-CN');
            
            // 初始化图表
            initializeCharts();
            
            // 初始化状态指示器
            updateStatusIndicators();
            
            // 初始化仪表盘
            updateGauges();
            
            // 设置定时器 - 每秒更新倒计时
            setInterval(updateCountdown, 1000);
            
            // 设置定时器 - 每60秒更新数据
            setInterval(performDataUpdate, 60000);
            
            console.log('流动性监控仪表盘已启动，每60秒自动更新数据');
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', initializeApp);
        
        // 手动刷新功能（可选）
        function manualRefresh() {
            countdownTimer = 60;
            performDataUpdate();
        }
        
        // 添加键盘快捷键支持（按R键手动刷新）
        document.addEventListener('keydown', function(event) {
            if (event.key === 'r' || event.key === 'R') {
                event.preventDefault();
                manualRefresh();
            }
        });
    </script>
</body>
</html>